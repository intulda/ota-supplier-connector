# ota-spplier-connector

## 개요

---

ota-supplier-connector는
여러 OTA(Online Travel Agency) 공급사와의 숙소 데이터를 안정적으로 연동하기 위한 백엔드 연동 모듈입니다.

본 프로젝트는 단순 CRUD가 아닌,

- 외부 시스템 연동에서 발생하는 실패 / 재시도
- 공급사별 상이한 API 규격
- 중복 데이터 적재 리스크

를 실무 관점에서 어떻게 설계하고 해결하는지를 보여주는 것을 목표로 합니다.

## 이 프로젝트는 뭐야?

---

OTA 연동 도메인에서 가장 위험한 문제는 다음 두 가지입니다. \
재시도로 인한 중복 적재 / 중복 예약 \
장애 발생 시 원인 파악이 어려운 로그 구조 \
본 프로젝트는 이 두 문제를 의식적으로 설계 단계에서부터 해결합니다.

## 코드 디자인 우려되는 사항

### Idempotency

외부 공급사 API는 네트워크 장애, 타임아웃 등으로 인해 \
동일 요청이 여러 번 재시도될 수 있습니다.

이때 가장 치명적인 문제는
- 동일 숙소 데이터의 중복 적재
- (실제 서비스라면) 중복 예약 발생

#### 해결 전략

- 공급사에서 내려주는 고유 식별자(externalId)
- 내부에서 정의한 공급사 타입(supplierType)

를 복합 유니크 키로 사용하여 여러 번 요청이 와도 결과가 동일하게 유지되도록 설계합니다.

이를 통해 재시도 시에도 데이터 정합성 보장 외부 API 신뢰도가 낮아도 내부 시스템 안정성 유지

`재시도는 시스템의 실패가 아니라, 전제 조건이다` 라는 관점에서 설계했습니다.


### Observability 

연동 시스템에서 장애가 발생했을 때 가장 중요한 것은 **얼마나 빨리 원인을 특정할 수 있는가** 입니다.

```java
log.error("API failed");
```

해당 로그로는 많은 정보를 알 수 없습니다.
- 어떤 공급사인지 
- 어디서 에러가 났는지
- 네트워크 문제인지, 데이터 문제인지 

#### 해결전략

공급사 단위로 로그 포맷을 강제합니다.

```
[SUPPLIER=EXPEDIA][STEP=FETCH][RESULT=FAILED][REASON=TIMEOUT]
```

이를 통해 로그만 보고도 장애 공급사 즉시 식별 \
재현 없이 운영 대응 가능 \
모니터링 시스템 연동에 유리한 구조

### 기술 스택

- Java 25
- Spring Boot
- Spring Data JPA
- H2 (local test)
- Lombok
- JUnit 5